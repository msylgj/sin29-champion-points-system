# æ•°æ®åº“æ¨¡å‹è®¾è®¡å®Œæˆæ€»ç»“

## å®Œæˆæ—¥æœŸ
2026-01-29

## å®Œæˆå†…å®¹

### 1. æ•°æ®æ¨¡å‹æ–‡ä»¶

åˆ›å»ºäº†8ä¸ªå®Œæ•´çš„ SQLAlchemy æ•°æ®æ¨¡å‹æ–‡ä»¶ï¼š

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| [enums.py](backend/app/models/enums.py) | æšä¸¾å®šä¹‰ï¼šæ€§åˆ«ã€å¼“ç§ã€è·ç¦»ã€èµ›åˆ¶ã€èµ›äº‹çŠ¶æ€ã€å­£åº¦ã€ç”¨æˆ·è§’è‰² |
| [user.py](backend/app/models/user.py) | ç”¨æˆ·è¡¨ï¼šç”¨äºç³»ç»Ÿè®¤è¯å’Œæƒé™ç®¡ç† |
| [athlete.py](backend/app/models/athlete.py) | è¿åŠ¨å‘˜è¡¨ï¼šå­˜å‚¨è¿åŠ¨å‘˜åŸºæœ¬ä¿¡æ¯ |
| [event.py](backend/app/models/event.py) | èµ›äº‹è¡¨ï¼šå¹´åº¦å­£åº¦èµ›äº‹é…ç½®å’Œä¿¡æ¯ |
| [scoring_rule.py](backend/app/models/scoring_rule.py) | ç§¯åˆ†è§„åˆ™è¡¨ï¼šçµæ´»çš„JSONé…ç½®ç§¯åˆ†è§„åˆ™ |
| [event_participant.py](backend/app/models/event_participant.py) | èµ›äº‹å‚ä¸è€…è¡¨ï¼šè¿åŠ¨å‘˜å‚èµ›ç™»è®°ä¿¡æ¯ |
| [score.py](backend/app/models/score.py) | æˆç»©è¡¨ï¼šæ¯”èµ›æˆç»©å’Œç§¯åˆ†è®°å½• |
| [aggregate_points.py](backend/app/models/aggregate_points.py) | ç§¯åˆ†æ±‡æ€»è¡¨ï¼šå¹´åº¦å­£åº¦ç§¯åˆ†ç»Ÿè®¡ |
| [operation_log.py](backend/app/models/operation_log.py) | æ“ä½œæ—¥å¿—è¡¨ï¼šå®¡è®¡å’Œè¿½è¸ªæ‰€æœ‰æ“ä½œ |

### 2. æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬

å®Œæ•´æ›´æ–°äº† [database/init.sql](database/init.sql)ï¼ŒåŒ…æ‹¬ï¼š

- **9ä¸ªä¸»è¡¨** + **3ä¸ªè§†å›¾**
- **å®Œæ•´çš„çº¦æŸ**: PRIMARY KEY, FOREIGN KEY, UNIQUE, NOT NULL, CHECK
- **ä¼˜åŒ–çš„ç´¢å¼•**: æ ¹æ®æŸ¥è¯¢æ¨¡å¼åˆ›å»º30+ä¸ªç´¢å¼•
- **ç¤ºä¾‹æ•°æ®**: ç”¨æˆ·ã€è¿åŠ¨å‘˜ã€èµ›äº‹ã€æˆç»©ç­‰æµ‹è¯•æ•°æ®
- **3ä¸ªæŸ¥è¯¢è§†å›¾**: æˆç»©æ±‡æ€»ã€èµ›äº‹æ’åã€å¹´åº¦æ’å

### 3. æ•°æ®åº“è®¾è®¡æ–‡æ¡£

åˆ›å»ºäº†è¯¦ç»†çš„ [DATABASE_DESIGN.md](DATABASE_DESIGN.md) æ–‡ä»¶ï¼ŒåŒ…æ‹¬ï¼š

- **ERå›¾**: å®Œæ•´çš„æ•°æ®åº“å…³ç³»å›¾
- **è¡¨è¯¦è§£**: æ¯ä¸ªè¡¨çš„å­—æ®µã€ç±»å‹ã€çº¦æŸè¯´æ˜
- **æšä¸¾å€¼**: æ‰€æœ‰æšä¸¾ç±»å‹çš„å®šä¹‰
- **å…³ç³»è¯´æ˜**: ä¸€å¯¹å¤šã€å¤šå¯¹å¤šå…³ç³»æè¿°
- **è®¾è®¡ç‰¹ç‚¹**: å®Œæ•´çš„æ—¶é—´æˆ³ã€çµæ´»é…ç½®ã€æ“ä½œå®¡è®¡ç­‰
- **æ‰©å±•å»ºè®®**: åç»­å¯èƒ½çš„è¡¨å’ŒåŠŸèƒ½æ‰©å±•

## æ ¸å¿ƒè®¾è®¡ç‰¹æ€§

### âœ… æ”¯æŒçš„æ¯”èµ›æ¨¡å¼

**è·ç¦»**: 18m, 30m, 50m, 70mï¼ˆå››ç§è·ç¦»éƒ½æ”¯æŒï¼‰

**èµ›åˆ¶**: 
- æ’ä½èµ› (ranking) - ç›´æ¥æ’åºè®¡åˆ†
- æ·˜æ±°èµ› (elimination) - æ”¯æŒè½®æ¬¡è¿½è¸ª
- å›¢ä½“èµ› (team) - å¤šè¿åŠ¨å‘˜ç»„é˜Ÿ

**å¼“ç§**:
- åæ›²å¼“ (recurve)
- å¤åˆå¼“ (compound) 
- ä¼ ç»Ÿå¼“ (traditional)
- é•¿å¼“/ç¾çŒå¼“ (longbow)
- å…‰å¼“ (barebow)

**åˆ†ç»„**:
- ç”·å­ç»„ (male)
- å¥³å­ç»„ (female)
- æ··åˆç»„ (mixed)

### âœ… æ—¶é—´ç»´åº¦

- **å¹´åº¦** (year): æ”¯æŒå¤šä¸ªå¹´ä»½çš„èµ›äº‹
- **å­£åº¦** (season): Q1-Q4æŒ‰å­£åº¦åˆ†ç±»
- **æ—¶é—´èŒƒå›´** (start_date, end_date): ç²¾ç¡®çš„èµ›äº‹æ—¥æœŸ

### âœ… ç§¯åˆ†ç³»ç»Ÿ

**çµæ´»çš„ç§¯åˆ†è§„åˆ™é…ç½®**:
- åŸºäºæ’åçš„ç§¯åˆ† (rank-based): æ’åâ†’ç§¯åˆ†æ˜ å°„
- åŸºäºæˆç»©çš„ç§¯åˆ† (score-based): æˆç»©Ã—ç³»æ•°è®¡ç®—
- è‡ªå®šä¹‰è§„åˆ™ (custom): æ”¯æŒæ‰©å±•

**æ”¯æŒå¤šç»´ç§¯åˆ†ç»Ÿè®¡**:
- æ€»ä½“æ’å
- æŒ‰æ€§åˆ«åˆ†ç»„æ’å
- æŒ‰å¼“ç§åˆ†ç»„æ’å
- æŒ‰å­£åº¦åˆ†ç»„ç»Ÿè®¡
- å¹´åº¦æ±‡æ€»ç»Ÿè®¡

### âœ… å®Œæ•´çš„å®¡è®¡å’Œè¿½è¸ª

- **è¿åŠ¨å‘˜å‚èµ›å…¨æµç¨‹**: registered â†’ checked_in â†’ participated â†’ withdrew
- **æˆç»©æœ‰æ•ˆæ€§æ ‡è®°**: æ”¯æŒæ— æ•ˆæˆç»©æ ‡è®°
- **æ“ä½œæ—¥å¿—**: è®°å½•æ‰€æœ‰ç”¨æˆ·æ“ä½œã€ä¿®æ”¹æ—¶é—´ã€ä¿®æ”¹å†…å®¹
- **æ•°æ®ç‰ˆæœ¬**: created_at/updated_atæ—¶é—´æˆ³

## å…³ç³»æ˜ å°„

```
users (1) â”€â†’ (å¤š) operation_logs

athletes (1) â”€â†’ (å¤š) scores
athletes (1) â”€â†’ (å¤š) event_participants  
athletes (1) â”€â†’ (å¤š) athlete_aggregate_points

events (1) â”€â†’ (å¤š) scores
events (1) â”€â†’ (å¤š) event_participants
events (å¤š) â”€â†’ (1) scoring_rules

event_participants â† ä¸­é—´è¡¨ â†’ athletes + events (å¤šå¯¹å¤š)
```

## æ•°æ®åº“ä¼˜åŒ–

### ç´¢å¼•ç­–ç•¥

1. **ä¸»é”®å’Œå¤–é”®ç´¢å¼•**: è‡ªåŠ¨åˆ›å»º
2. **æŸ¥è¯¢çƒ­ç‚¹ç´¢å¼•**: 
   - athlete_id, event_id (æˆç»©æŸ¥è¯¢)
   - year, season (æ—¶é—´èŒƒå›´æŸ¥è¯¢)
   - rank, gender_group, bow_type (åˆ†ç»„æ’å)
   - status (èµ›äº‹çŠ¶æ€è¿‡æ»¤)
3. **å¤åˆç´¢å¼•**: (athlete_id, year, season) ç”¨äºå¿«é€Ÿæ±‡æ€»

### æ€§èƒ½è€ƒè™‘

- ä½¿ç”¨JSONBå­˜å‚¨çµæ´»çš„ç§¯åˆ†è§„åˆ™é…ç½®
- æ—¶é—´æˆ³å­—æ®µä½¿ç”¨timezone aware
- æä¾›èšåˆè§†å›¾å‡å°‘åº”ç”¨å±‚è®¡ç®—
- å¤–é”®CASCADEåˆ é™¤ä¿è¯æ•°æ®ä¸€è‡´æ€§

## ä¸‹ä¸€æ­¥å·¥ä½œ

### ç«‹å³å¯è¿›è¡Œ âœ…

1. **ç§¯åˆ†è®¡ç®—ç®—æ³•** (ä»»åŠ¡2): åŸºäºscoring_rulesè¡¨å®ç°
2. **åç«¯APIå¼€å‘** (ä»»åŠ¡3-8): åŸºäºè¿™äº›æ¨¡å‹æ„å»ºRESTæ¥å£
3. **æ•°æ®å¯¼å…¥å¯¼å‡º** (ä»»åŠ¡18): Excelæ¨¡æ¿å·²æ”¯æŒæ‰€æœ‰å­—æ®µ

### åç»­æ‰©å±• ğŸ”„

1. æ·»åŠ é˜Ÿä¼è¡¨(teams)æ”¯æŒå›¢ä½“èµ›
2. æ·»åŠ æ¯”èµ›è½®æ¬¡è¡¨(competition_rounds)
3. æ·»åŠ ä¿®æ”¹å†å²è¡¨è®°å½•æˆç»©å˜æ›´
4. æ·»åŠ ç³»ç»Ÿé…ç½®è¡¨å…¨å±€å‚æ•°ç®¡ç†
5. æ·»åŠ é€šçŸ¥è¡¨ç³»ç»Ÿé€šçŸ¥åŠŸèƒ½

## æ•°æ®åº“åˆå§‹åŒ–

åœ¨Dockerç¯å¢ƒä¸­ï¼Œinit.sqlä¼šåœ¨PostgreSQLå®¹å™¨å¯åŠ¨æ—¶è‡ªåŠ¨æ‰§è¡Œï¼š

```bash
# å¯åŠ¨Dockerç¯å¢ƒ
docker-compose up -d

# æ£€æŸ¥æ•°æ®åº“æ˜¯å¦åˆ›å»ºæˆåŠŸ
docker-compose exec postgres psql -U postgres -d archery -c "\dt"

# æŸ¥çœ‹æ‰€æœ‰è¡¨
docker-compose exec postgres psql -U postgres -d archery -c "\dt"

# æŸ¥è¯¢ç¤ºä¾‹æ•°æ®
docker-compose exec postgres psql -U postgres -d archery -c "SELECT * FROM athletes;"
```

## æ–‡ä»¶å¯¹åº”å…³ç³»

- **Pythonæ¨¡å‹** â†’ [backend/app/models/](backend/app/models/) ç›®å½•
- **æ•°æ®åº“è„šæœ¬** â†’ [database/init.sql](database/init.sql)
- **è¯¦ç»†æ–‡æ¡£** â†’ [DATABASE_DESIGN.md](DATABASE_DESIGN.md)
- **ORMé…ç½®** â†’ [backend/app/database.py](backend/app/database.py)

---

**çŠ¶æ€**: âœ… å®Œæˆ  
**åˆ›å»ºè€…**: AI Assistant  
**æœ€åæ›´æ–°**: 2026-01-29
